#summary Beskriver en logiska referensarkitekturen inkl referensmodellerna.
#labels RA

= Introduktion =

== Förkortningar och termer == 

|| *Förkortning* || *Betydelse* ||
|| VGR || Västra Götalandsregionen ||
|| SSL || Stockholms Läns Landsting ||
|| 3R || Samarbete mellan tre regioner; VGR, Region Skåne och SLL ||
|| RIV || Regelverk för interoperabilitet i vården ||
|| BIF || Bastjänster för informationsförsörjning ||
|| DMIM || ||
|| OSOA || Open Service Oriented Architecture - Organisationen bakom bland annat SCA ||
|| SCA || Service Component Architecture ||


== Bakgrund ==
Här beskrivs den logiska delen av den referensarkitektur som har tagits fram gemensamt inom 3R och släppts som öppen källkod av VGR här under Öppna Program. 

Referensarkitekturen innefattar även en mer konkret och implementations teknisk arkitektur, se [RA_Teknisk_arkitektur].

== Syfte ==

Den logiska referensarkitekturens viktigaste innehåll är dess metamodeller, så kallade _referensmodeller_. Dessa definierar det vokabulär som skall användas när man talar om arkitektur, och svarar på frågor som "Vad menar vi med ett _system_ och hur förhåller det sig till en _komponent_?" etc.

Alla IT-lösningar som upphandlas och utvecklas skall baseras på dessa referensmodeller. Syftet med den logiska arkitekturen och referensmodellerna är alltså att definiera den taxonomi som tillämpas både internt och i kommunikationen med leverantörer samt den struktur som förväntas av de lösningar som byggs eller upphandlas.

Se även [RA_Introduktion] för övergripande syfte med att ha en referensarkitektur. 

== Referenser ==
=== Allmänt ===
|| *Organisation* || *Dokument* || *Beskrivning* ||
|| 3R || Modell Referensarkitektur 3R|| Modell för referensarkitektur (format: eap / enterprise Architect) ||

=== Yttre arkitektur ===

|| *Organisation* || *Dokument* || *Beskrivning* ||
|| !CarLink Plus || Referensarkitektur Rapport 2 April 2004. || - ||
|| HISA || HISA (Healthcare Information Service Architecture). || Detta dokument refereras från !CareLink Plus. Dokumentet utgör en möjlig bas för fortsatt detaljering av den yttre arkitekturen, m.a.p process-orienterad integration. HISA defnierar bl.a. en metod för identifiering av tjänstedomäner. ||

=== Inre arkitektur ===

|| *Organisation* || *Dokument* || *Beskrivning* ||
|| OSOA || [http://www.osoa.org/display/Main/Service+Component+Architecture+Home SCA] || Innehåller ett antal specifikationer kring SCA. ||

Se [RA_Introduktion] för länkar till övriga dokument inom referensarktekturen.

= Sammanfattning - viktigt innehåll =
Den logiska referensarkitekturen är uppdelad i en inre och en yttre arkitektur. Arkitekturen är formaliserad med hjälp av referensmodeller, ett slags metamodeller som beskriver termer/entiteter samt hur dessa relaterar till varandra. 

Referensmodellerna består av två delar: en referensmodell för den _inre_ arkitekturen och en referensmodell för den _yttre_ arkitekturen.

Den inre arkitekturen beskriver principer för arkitekturen inom de _system_ som utvecklas eller upphandlas. Varje system modulariseras genom att delas upp i ett antal _verksamhetskomponenter_. Den inre arkitekturen bygger på principerna för SCA. 

Den yttre arkiteturen beskriver hur systemen integreras med varandra genom en tjänsteorienterad arkitektur. Referensmodellen för den yttre arkitekturen definierar _integrationstjänster_, vilket är de tjänster som krävs för integration av verksamhetens processer. Integrationstjänsterna är indelade i olika _tjänstedomäner_. 

Kopplingen mellan den inre och den yttre arkitekturen utgörs av att en tjänstedomän, i normal- och idealfallet, är lika med ett system. Det är _verksamhetskomponenterna_ som publicerar de integrationstjänster som behövs för att systemet ska kunna integreras med andra system. 


Yttre arkiteturer - dvs specifikationer av integrationstjänster - drivs fram och ägs av en _Enterprise Architecture_-funktion. Inre arkitektur – de verksamhetskomponenter som sammantaget realiserar beställd funktionalitet inom ramen för en tjänstedomän/ett system – bildar ett fristående förvaltningsobjekt. Enterprise Architecture bistår projekten vid modellering av inre arkitetur, men tar inget ägarskap för modellerna.

Referensarkitekturen är framtagen gemensamt för ”3R” (tre regioner: Västra Götalandsregionen, Region Skåne, Stockholms Läns Landsting), men kan påföras restriktioner drivna av regionala krav. Dessa region- eller tjänstedomän-specifika anvisningar kallas _profiler_. 

Dokumentet ger en överblick över hur spårbarhet ska åstadkommas från modeller i den logiska vyn till modeller i de teknologiska och tekniska vyerna. Detaljerna för spårbarhet återfinns i underliggande teknologi-specifika anvisningar. 

Följande listning redovisar de viktigaste aspekterna av spårbarhet som behöver åskådliggöras:
  * Spårbarhet till plattformsspecifik design för de plattformar 3Rs EA avser omfatta
  * Spårbarhet till strukturer för konfigurationsstyrning av systems beskrivning och realisering. Här avses strukturer i såväl modeller som testfall, funktionalitet och projektdefinitioner för utvecklingsverktyg.
  * Spårbarhet till katalogstrukturer (repositorier) för versionsindikerade tekniska tjänstespecifkationer (t.ex. XSD, WSDL)
  * Spårbarhet till komponentkataloger för plattformsspecifika binärer (enheter för komponentbaserad återanvändning inom ett system)
  * Spårbarhet till namnrymder för såväl integrationstjänster som verksamhetskomponenter.

= Den yttre arkitekturen =

http://oppna-program.googlecode.com/svn/wiki/RA_Logisk_arkitektur_Yttre_ark_Refmodell.png
Bilden visar referensmodellen för den yttre arkitekturen. 

Den yttre arkitekturen består av ett antal _verksamhetsdomäner_ (ex Vård, Läkemedel etc), som i sin tur innehåller ett antal _tjänstedomäner_. Varje tjänstedomän innehåller ett antal _integrationstjänster_. En integrationstjänst är antingen _orkestrerande_ eller _atomär_. 

Exempel: 

http://oppna-program.googlecode.com/svn/wiki/RA_Logisk_arkitektur_Yttre_ark_exempel.png
 

Bilden illustrerar tre tjänstedomäner, varav en är en process-nära tjänstedomän bestående av en eller flera orkestrerande integrationstjänster. Illustrationen visar inte hur tjänstedomänerna i sin tur kan delas in i verksamhetsdomäner.

Varje tjänstedomän omfattar ett antal integrationstjänster. Integrationstjänsterna är av två slag – atomära eller orkestrerande.

De atomära tjänsternas gränssnitt är just gränssnitt i traditionell bemärkelse. De representerar ett informationobjekt eller en uppgift och därmed associerade operationer. De har inga beroenden på gränssnittsnivå till andra tjänster. Definitionen av en atomär integrationstjänst gör inga antaganden om realiseringens arkitektur. De representerar atomära transaktioner med ickefunktionella krav på ”allt eller inget”. En atomär integrationstjänst kan vara synkron eller asynkron. En synkron tjänst definieras av traditionella uppdrag/svar-operationer. En asynkron tjänst kan vara antingen envägs- eller tvåvägs. I båda fallen finns ett uppdragsgränssnitt med envägsoperationer (utan svar). I fallet tvåvägstjänst finns dessutom ett  svarsgränssnitt – också detta med envägsoperationer. Svarsgränssnittet måste realiseras av den orkestrerande tjänst till vilken den asynkrona integrationstjänsten ska vara en partner. 

Asynkrona envägstjänster används i första hand för att synkronisera information som föds ur systemarvet eller för start av en asynkron orkestrerande integrationstjänst. Asynkrona tvåvägstjänster är till för att möjliggöra asynkron orkestrering från en orkestrerande integrationstjänst. Dessa tjänster kan vara av batch-liknande karaktär, eller av andra skäl lämpa sig bäst för asynkron integration.

De orkestrerande integrationstjänsterna är definierade i termer av ett primärt tjänstegränssnitt och ett eller flera partner-länkar. Dessa länkar kan vara synkrona uppdrag/svar, asynkrona envägs eller asynkrona tvåvägs. En partnerlänk definierar ett beroende till an atomär integrationstjänst. För tvåvägslänkar tillkommer dessutom en svarstjänst, genom vilken partnern levererar det asynkrona svarsmeddelandet. 

Svarsgränssnittet tillhör den asynkrona, atomära tvåvägstjänsten. Detta förhållande framgår inte av illustrationen. Istället tycks svarsgränssnittet felaktigt ägas av den orkestrerande integartionstjänsten och hamnar således i fel tjänstedomän.  Det kan också finnas en svarstjänst för att ta emot felmeddelanden. Dessa är inte illustrerade i bilden.
Ägarskap av gränssnitt är olika för orkestrerande och atomära integrationstjänster. Atomära integrationstjänster äger såväl det producerande som eventuella konsumerande gränssnitt (dvs svarsgränssnitten). Av detta följer att orkestrerande integrationstjänster endast äger det primära gränssnittet. Syftet med dessa ägasrskapsregler är att behålla de atomära integrationstjänsternas obereonde till sin omgivning.

En orkestrerande integrationstjänst definieras i syfte att just orkestrera en process. Det primära gränssnittet har som regel bara en operation, vars semantik därför är likvärdig med tjänsten som helhet. Orkestrerande processer definieras således i termer av den process de orkestrerar, snarare än av en uppsättning operationer. Processbeskrivningen kan därför ses som en del av tjänstedefinitionen. Den behöver inte vara exekverbar, men är förmodligen uttryckt i en notation som är närliggande dess exekverbara motsvarighet.

= Inre arkitektur och verksamhetskomponenter =

http://oppna-program.googlecode.com/svn/wiki/RA_Logisk_arkitektur_Inre_ark.png

Aktivering av funktionalitet kräver inte integrationstjänster. Integrationstjänster syftar till att realisera integrationsbehov, mellan tjänstedomäner. De teknologier och koncept på vilka integrationstjänster vilar, är inte lämpade för modularisering av funktionalitet i syfte att nå återanvändning, reducera komplexitet eller normalisera implementationen av verksamhetsregler.
 
Vi behöver därför ett angreppssätt för modularisering, som är tillräckligt lättviktigt och tillräckligt väl integrerat i vald realiseringsplattform för att inte vara i konflikt med dessa mål. Grunden för modulariseringen är en enhet som kallas Verksamhetskomponent. Verksamhetskomponenter ordnas i en hierarkisk struktur. En verksamhetskomponent är en relativt stor enhet som representerar ett väl avgränsat funktionsområde. 

Verksamhetskomponenter klassificeras efter den typ av funktionalitet de representerar: informationsorienterad, processorienterad, adapter eller generell / stödjande karaktär. En verksamhetskomponent representerar ett för verksamheten relevant begrepp och av tillräcklig omfattning för att vara synlig i planer, funktionella beskrivningar, konfigurationsstyrning, ändringshantering och leveranshantering. Det betyder att dess realisering kan spänna över så väl användargränssnitt, som verksamhetsrgler och informationshanteringsregler. Detta gäller oavsett kategori, även om tyngdpunkten mellan skikten förskjuts beroende på kategori. 

En Entitetskomponent (informationsorienterad) representerar regler för åtkomst och lagring av en logiskt sammanhängande delmängd av en informationsmodell. Dessa regler beskrivs i det undre av tre möjliga skikt: resursskiktet. Det överliggande verksamhetsskitet beskriver regler av mer bearbetande karaktär, som spänner över flera av de ägda informationsobjekten. Dessa regler kan också referera till andra – i hierarkin underordnade – entitetskomponenter. Regler som rör presentation, flödesstyrning och rent allmänt att reagera på händelser från omgivningen, beskrivs i det översta skiktet, kallat anslutningsskikt. Anslutningsskiktet kan definiera ett användargränssnitt för administration av den ägda informationen. Detta ska inte vara ett processtödjande gränssnitt, utan enbart erbjuda informationstjänster som är hårt kopplade till den ägda informationen. Anslutningsskiktet kan också fånga händelser från systemets omgivning genom att realisera integrationstjänster. Mellan skikten definieras gränssnitt, som kallas komponenttjänster. De översätts direkt från UML till plattformens motsvarighet för gränssnittsdefinitioner (t.ex. Java-interface). Verksamhetskomponenter samverkar så väl intern som mellan komponenttjänster. Samverkan mellan verksamhetskomponenter sker alltid i harmoni med den hierarkiska struktur i vilken verksamhetskomponenterna är inordnade. Integration mellan komponenttjänsterna tillåts bara inom ett system. Hur stor är då en entitetskomponent? En entitetskomponents ansvar täcker den mängd regler, verksamhetstjänster och dataaccesstjänster som blir följden av att ha ägarskap för ett utsnitt om 5 – 40 instansklasser i en traditionellt modellerad ”blomblad”. (...med reservation för att HL7 ställer detta mätetal på kant)

Transaktionshantering är formaliserad med avseende på samverkan mellan komponenttjänster. Den komponenttjänst (operation i tjänsten) som ligger överst i en anropskedja (alltid anropad från anslutningsskiktet i den egna verksamhetskomponenten) ansvarar för all underliggande uppdatering av databaser koordineras i form av en atomär transaktion. 
Krav på behörighetskontroll definieras genom policy på operationer i komponenttjänster. Behörighetskrav är naturligt ett ansvar för de funktioner som har kunskap kring det data som hanteras. Det finns dock stor potential för rationalisering och ökad robusthet, om policy kan representeras även i den tekniska realiseringen. Såväl Java- som .Net-plattformen har en mekanism som lämpar sig väl för deklarativ anslutning till behörighetsfunktionen. I Java-plattformen kan anrop till behörighetsfunktionen generaliseras till s.k. Annoteringar. Motsvarigheten i .Net kallas Attribut. Detta förutsätter att anslutningsskiktet har en generell - och helst transparent - mekanism för att tillgängliggöra biljett-information via trådkontexten. 

Denna plötsliga tekniska djupdykning kan tyckas malplacerad. Den är dock viktig för att underbygga förtroende för ansatsens realiserbarhet. Om vi associerat ansvaret för behörighetskontroll till integrationstjänster (d.v.s. anslutningsskiktet för verksamhetskomponenter som realiserar integrationstjänster), hade vi introducerat en risk för redundans. Verksamhetskomponenter anropar varandra via komponenttjänster. En komponenttjänst i en entitetskomponent som anropas i tre led med ursprung i en processkomponent måste fortfarande ta ansvar för behörighetskontroll för den informationsåtkomst entitetskomponenten ansvarar för. 

En processkomponents funktionalitet representerar en aktivitet eller process. De regler som allokeras till en processkomponent har ofta sitt ursprung i ett användningsfall eller processmodell. Till skillnad från entitetskomponenter har processkomponenten sin tyngdpunkt förskjuten till verksamhets- och anslutningsskiktet. Anslutningsskiktet realiserar ofta integrationstjänster (SOA-tjänster), användartjänster (t.ex. portlets, eller en dialog i en rik klient) eller både och. Om anslutningsskiktet i processkomponenten realiserar en orkestrerande integrationstjänst (t.ex. i form av ett bpel-skript), saknas i regel övriga skikt. Verksamhetsskiktet i en processkomponent är av uppgiftsorienterad karaktär. Om anslutningsskitet definierar en användardialog, kan distribuerad kommunikation krävas mellan anslutningsskiktet och verksamhetsskiktet (s.k. rik klient). Det är dock önskvärt att anslutningsskiktet i detta fall delas upp i den distribuerade dialoghanteringen och en server-del med specifikt ansvar för att ansluta dialog-delen. På så sätt minskas verksamhetsskiktets beroende till klienten. Man får dessutom en beredskap för att realisera sessionbaserad hantering på server-sidan, vilket inte kan ske i verksamhetsskiktets tillståndslösa komponenttjänster. Två av processkomponenterna i bilden realiserar inte någon integrationstjänst, men har trots detta ett anslutningsskikt. Det innebär att komponenterna definierar en eller flera användartjänster.

= Samverkan yttre och inre arkitektur =

http://oppna-program.googlecode.com/svn/wiki/RA_Logisk_arkitektur_Samverkan.png

Bilden illustrerar samverkan mellan yttre och inre arkitektur.

En mängd samverkande verksamhetskomponenter bildar ett System. Samverkan mellan system kallas integration och ska ske via atomära integrationstjänster som koordineras av orkestrerande integrationstjänster, enligt principer definierade av den yttre referens arkitekturen. Grunden för vad som bildar ett system, är i idealfallet den samma som för en tjänstedomän. Bilden illustrerar ett schematiskt exempel på detta förhållande.
 
Tjänstedomänens integrationstjänster utgör systemets gränsyta. Tjänstedomän ”A” ovan representerar ett typiskt operativt verksamhetsstöd för en del av vårdprocessen. Systemet kan ha upphandlats av en leverantör. Tjänstedomänens (och systemet) funktionella ansvar definieras av en ”blombladsmodell” och den funktionalitet den syftar till att understöda. System ”C” i bilden är av samma karaktär. Enterprise Architecture för 3R har definierat de integrationstjänster som krävs för att funktionaliteten ska kunna integreras i den övergripande vårdprocessen. Integrationstjänsterna representerar m.a.o. de strategiska behoven av integration av verksamhetens processer. Tjänstedomänen ”B” representerar däremot själva integrationen av vårdprocessen (eller en viktig aspekt av integrationen). Den består således huvudsakligen av orkestrerande integrationstjänster. Dessa realiseras av ett för domänen vigt system – nämligen System ”B”. System ”B” är uppbyggt av sinsemellan oberoende processkomponenter. Var och en av dessa realiserar en orkestrerande integrationstjänst. De består således bara ett anslutningsskikt med tänkt realisering i WS-BPEL.

= Plattformstjänster =

http://oppna-program.googlecode.com/svn/wiki/RA_Logisk_arkitektur_Plattformstjanster.png

 Referensarkitekturen tillåter Plattformskomponenter (en typ av verksamhetskomponent i den inre arkitekturen) i alla system. Plattformskomponenter som bedöms vara av allmänt värde – även utanför det system de tillhör, kan  propageras till verksamhets/systemövergripande plattformsfunktioner. Dessa ägs då av EA-ramverket, som kan sägas representera en ”virtuell” domän uppdelad i tekniska tjänstedomäner i syfte att inordna delade plattformskomponenter i referensarkitekturens strukturer.

= Exempel profil =
Profiler används för att reducera frihetsgraden för ett specifikt system eller organisation. En profil kan också användas för att härleda nya termer från existerande. Nedanstående profil-exempel illustrerar båda fallen.

  # Integrationstjänster realiseras uteslutande av Entitetskomponenter.
  # Entitetskomponenter exporterar (publicerar) inte användartjänster.
  # Entitetstjänsterna i Resursskiktet realiseras m.h.a. HTBs datatjänster 
  # En Tillämpning definieras som en eller flera Process-komponenter begränsade av följande regler:
    # Anslutningsskikt med enbart Användartjänster (Integrationstjänster publiceras ej). 
    # Resursskikt saknas.
    # Komponenttjänster i andra verksamhetskomponenter refereras ej.




 